# 直方图处理
## 定义
灰度级范围为 $\left [ 0,L-1 \right ]$ 的数字图像的直方图是离散函数 $h\left ( r_{k}  \right ) =n_{k}$，其中 $r_{k}$ 是第 $k$ 级灰度值，$n_{k}$ 是图像中灰度为 $r_{k}$ 的像素个数。实践中，经常除以图像像素总数来归一化直方图。简单来说，直方图是对应灰度级在图像中出现概率的一个估计，归一化直方图的所有分量之和应等于 1。

一般来说，暗图像的直方图分量集中在灰度级的低端，亮图像的直方图分量集中在灰度级的高端；低对比度图像具有较窄的直方图，且集中于直方图的中部，而高对比度图像的直方图则覆盖了较宽的灰度级范围，且像素分布不会太不均匀。直观上，若一幅图像的像素倾向于占据整个可能的灰度级并且分布均匀，则该图像会具有较高的对比度并展示灰度的较大变化，最终效果就会是一幅灰度细节丰富且动态范围较大的图像。

这也是下面直方图均衡的理论基础。
## 直方图均衡
直方图均衡的理论基础就是对输入图像进行一个变换，使得变换后图像的直方图在整个灰度级上均匀分布。

假设有如下变换
$$
s=T\left ( r \right ) ,0\le r\le L-1
$$
其中 $r$ 和 $s$ 分别为输入和输出图像，按照上面的先验，$s$ 在直方图想均匀分布，从概率论的角度来说就是 $s$ 的概率密度函数（PDF）应该是一个均匀分布，即：
$$
p_{s} \left ( s \right ) =\frac{1}{L-1} 
$$
由于 $s$ 的 PDF 函数又可以表示如下：
$$
p_{s} \left ( s \right ) =p_{r} \left ( r \right ) \left | \frac{dr}{ds}  \right | 
$$
我们便可以得到变换函数 $T$ 的微分函数为：
$$
\frac{ds}{dr} =\frac{dT\left ( r \right ) }{dr} =\left (  L-1\right ) p_{r} \left ( r \right ) 
$$
相应的，对上式积分就可得到我们需要的变换 $T$ 为：
$$
s=T\left ( r \right )=\left ( L-1 \right ) \int_{0}^{r} p_{r} \left ( w \right ) dw
$$
其中，$w$ 是积分的伪变量，公式右边是随机变量 $r$ 的累积分布函数（CDF），而这个我们完全可以从原图中统计得到。

以上就是直方图均衡化的推理过程。
## 直方图匹配（规定化）
## 局部直方图处理
## 在图像增强中使用直方图统计